<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mikitz' Encounter Generator</title>
    <link rel="icon" type="image/x-icon" href="/mikitz-ttrpg/favicon.ico">
    <!-- ICONS -->
    <script src="https://kit.fontawesome.com/7e282d14cd.js" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
    <!-- STYLESHEETS -->
    <link rel="stylesheet" href="/mikitz-ttrpg/css/styles.min.css" />
    <!-- MAIN -->
    <script src="/mikitz-ttrpg/js/encounter.js"></script>
    <!-- LOCAL LIBRARIES -->
    <script src="/mikitz-ttrpg/js/library/database.js"></script>
    <script src="/mikitz-ttrpg/js/library/fraction.js"></script>
    <script src="/mikitz-ttrpg/index.js"></script>
    <script src="/mikitz-ttrpg/js/library/global.js"></script>
    <script src="/mikitz-ttrpg/js/library/droll.js"></script>
    <!-- LIBRARIES -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <!-- DATA -->
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/selectsData.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/nonCombatEncounters.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/hazards.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/combatEncounters.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/weather.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/ship.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/mysteriousIsland.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/dragons.js"></script>
    <script src="/mikitz-ttrpg/data/js-data/encounter-generator/encounterDefaults.js"></script>
    <!-- TABLES -->
    <script src="/mikitz-ttrpg/data/version_numbers.js"></script>

</head>
<style>
    .user-options {
        flex-flow: column wrap;
        justify-content: center;
        align-items: center;
        row-gap: 1rem;
    }
    .aspect-legend {
        font-size: 25px;
        text-decoration: underline;
        text-align: center;
        color: var(--text-clr);
        margin-bottom: 10px;
    }
    .history-container {
        background-color: var(--card-background-color);
        padding: 20px;
        border-radius: 20px;
    }
    .history {
        max-height: 300px;
        overflow-y: auto;
        width: fit-content;
    }
    .history td {
        text-align: center;
        width: fit-content;
    }
    .history li {
        margin-left: 30px;
    }
</style>
<body>
    <div class="site-nav">
        <a class="site-button" id="index" href="/mikitz-ttrpg/index.html"><i class="fa-solid fa-house"></i><span>Home</span></a>
        <a class="site-button" id="battle-map-generator" href="/mikitz-ttrpg/html/pages/battle-map-generator.html"><i class="fa-solid fa-map"></i><span>Battle Map</span></a>
        <a class="site-button-under-construction" id="calendar"><i class="fa-solid fa-calendar"></i><span>Calendar</span></a>
        <a class="site-button-active" id="encounter-generator" href="/mikitz-ttrpg/html/pages/encounter-generator.html"><i class="fa-solid fa-location-dot"></i><span>Encounter</span></a> 
        <a class="site-button" id="magic-shop-generator" href="/mikitz-ttrpg/html/pages/magic-shop-generator.html"><i class="fa-solid fa-store"></i><span>Magic Shop</span></a>
        <a class="site-button" id="npc-generator" href="/mikitz-ttrpg/html/pages/npc-generator.html"><i class="fa-solid fa-person-half-dress"></i><span>NPC</span></a>
        <a class="site-button" id="spellbook-generator" href="/mikitz-ttrpg/html/pages/spellbook-generator.html"><i class="fa-solid fa-book"></i><span>Spellbook</span></a>
        <a class="site-button-under-construction" id="star-system-and-galaxy-generator" href="/mikitz-ttrpg/html/pages/star-system-and-galaxy-generator.html"><i class="fa-regular fa-circle-dot"></i><span>System</span></a>
        <a class="site-button-under-construction" id="world-generator" href="/mikitz-ttrpg/html/pages/world-generator.html"><i class="fa-solid fa-earth-americas"></i><span>World</span></a>
        <span class="right">
            <a class="site-button" id="settings" href="/mikitz-ttrpg/html/settings.html"><i class="fa-solid fa-gear"></i><span>Settings</span></a>
            <a class="site-button" id="wiki" href="/mikitz-ttrpg/html/wiki.html"><i class="fa-solid fa-book-open"></i><span>Wiki</span></a>
        </span>
    </div>
    <div class="sub-nav" id="sub-nav">
        <a class="sub-nav-version-number nav-a" style="text-decoration: underline;" id="version-link" href="" target="_blank" rel="noopener noreferrer">
            <i class="fa-solid fa-code-commit" style="margin-right: 0.5rem;"></i>
            <span id="version-number"></span>
        </a>
        <a href="#" class="nav-a active"><i class="fa-solid fa-dice-d20"></i> <span>Generator</span></a>
    </div>v>
    </div>
    <main>
        <div class="main">
            <div class="side-panel">
                <fieldset class="user-options-container">
                    <legend style="display: none;" class="fieldset-legend">Append <i class="fa-solid fa-caret-down"></i>
                    </legend>
                    <div class="fieldset-content visible">
                        <div class="button-container">
                            <button id="generate-encounter" class="button">Generate</button>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="user-options-container">
                    <legend class="fieldset-legend">Attributes <i class="fa-solid fa-caret-down"></i></legend>
                    <div class="fieldset-content visible">
                        <div class="text-input-container">
                            <label class="text-input-label"><i id="encounter-name-help"
                                    class="bi bi-question-square"></i>Name</label>
                            <input class="text-input" placeholder="Encounter ####" type="text" id="name">
                        </div>
                        <div class="text-input-container">
                            <label class="text-input-label"><i id="guarantee-encounter-help"
                                    class="bi bi-question-square"></i>100%</label>
                            <input class="text-input" type="checkbox" id="100-percent">
                        </div>
                    </div>
                </fieldset>
                <fieldset class="user-options-container">
                    <legend class="fieldset-legend">Party <i class="fa-solid fa-caret-down"></i></legend>
                    <div class="fieldset-content visible">
                        <div class="select-container">
                            <label class="select-label"><i id="party-name-help"
                                    class="bi bi-question-square"></i>Name</label>
                            <select class="select-dropdown" id="select-party-input"></select>
                        </div>
                        <div class="text-input-container">
                            <label for="party-name" class="text-input-label">Party Name</label>
                            <input id="party-name-input" class="text-input" type="text">
                        </div>
                        <div class="select-container">
                            <label for="party-level" class="select-label">Party Level</label>
                            <select id="party-level-input" class="select-dropdown">
                                <option id="1">1</option>
                                <option id="2">2</option>
                                <option id="3">3</option>
                                <option id="4">4</option>
                                <option id="5">5</option>
                                <option id="6">6</option>
                                <option id="7">7</option>
                                <option id="8">8</option>
                                <option id="9">9</option>
                                <option id="10">10</option>
                                <option id="11">11</option>
                                <option id="12">12</option>
                                <option id="13">13</option>
                                <option id="14">14</option>
                                <option id="15">15</option>
                                <option id="16">16</option>
                                <option id="17">17</option>
                                <option id="18">18</option>
                                <option id="19">19</option>
                                <option id="20">20</option>
                                <option id="21">21</option>
                                <option id="22">22</option>
                                <option id="23">23</option>
                                <option id="24">24</option>
                                <option id="25">25</option>
                                <option id="26">26</option>
                                <option id="27">27</option>
                                <option id="28">28</option>
                                <option id="29">29</option>
                                <option id="30">30</option>
                            </select>
                        </div>
                        <div class="select-container">
                            <label for="party-size" class="select-label">Pary Size</label>
                            <select id="party-size-input" class="select-dropdown">
                                <option id="1">1</option>
                                <option id="2">2</option>
                                <option id="3">3</option>
                                <option id="4">4</option>
                                <option id="5">5</option>
                                <option id="6">6</option>
                                <option id="7">7</option>
                                <option id="8">8</option>
                                <option id="9">9</option>
                                <option id="10">10</option>
                            </select>
                        </div>
                        <div class="button-container">
                            <button id="settings-save-party" class="fieldset-button">Save Party</button>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="user-options-container">
                    <legend class="fieldset-legend"><i id="total-probs-help" class="bi bi-question-square"></i>Total Probs. <i class="fa-solid fa-caret-down"></i></legend>
                    <div class="fieldset-content visible flexbox-inner" id="total-probs-div"></div>
                </fieldset>
            </div>
            <div class="user-options">
                <div class="history-container visible">
                    <div class="aspect-legend"><i class="fa-solid fa-chevron-down" style="margin-right: 10px; cursor: pointer; rotate: 180deg;" id="toggle-history" name="toggle-display"></i><span class="clickable" name="toggle-display" id="toggle-history">History</span></div>
                    <div class="history collapsed" id="history">
                        <table class="styled-table">
                            <thead>
                                <th>Index</th>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>View</th>
                                <th>Delete</th>
                            </thead>
                            <tbody id="history-table-body"></tbody>
                        </table>
                    </div>
                </div>
                <table class="encounters-table styled-table" id="encounters-table">
                    <thead id="encounters-table-head">
                        <th>  </th>
                        <th>Tools</th>
                        <th><i id="quantity-help" class="bi bi-question-square"></i>Quantity <br><i id="probability-help" class="bi bi-question-square"></i>Probability</th>
                        <th>Environment</th>
                        <th>Party</th>
                        <th>Weather</th>
                    </thead>
                    <tbody id="encounters-table-body"></tbody>
                </table>
            </div>
        </div>
        <div id="encounter-output" class="modal" style="display: none;">
            <!------------------ 
                Modal content 
            -------------------->
            <div class="modal-content">
                <div class="modal-header">
                    <span id="modal-close" class="close">&times;</span>
                </div>
                
                <div class="modal-content-inner">
                    <table id="table-main" class="styled-table">
                        <thead>
                            <th> <h2>Index</h2> </th>
                            <th> <h2>Biome</h2> </th>
                            <th style="width: 300px;"> <h2>Encounters</h2> </th>
                            <th style="width: 300px;"> <h2>Weather</h2> </th>
                        </thead>
                        <tbody id="table-encounter-output"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</body>
<script>
    var db = new Dexie("mikitz_ttrpg_db") // Open or create the DB
    setupDB()
    window.addEventListener("load", async function () {
        readThemeAndSetTheme()
        preventLinkFiring()
        setupVersionNumber()
        await populateSelectPartyDropdown()
        await populatePartyParametersBasedOnSelectParty()
        await populateEncounterHistory()
        populateSidePanelElementsAndAttachHelpTippy()
        await addEncounterRow()
        encounterGeneratorListeners()
        await calculateProababiltyColumn()
        const myElement = document.getElementById("total-probs-div");
        const rect = myElement.getBoundingClientRect();
        const distanceFromTop = rect.top + 10
        myElement.style.height = `calc(100vh - ${distanceFromTop}px)`;
    });
</script>

</html>